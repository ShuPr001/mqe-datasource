{"version":3,"sources":["../src/response_handler.js"],"names":["filterLegendMetricString","name","length","displayString","firstIndex","lastIndexOf","filteredString","substring","lastIndex","indexOf","handle_response","target","response","timeseries","_","map","body","series","timerange","datapoints","values","value","index","Number","start","resolution","metric_prefix","tagset","key","addAppToAlias","addHostToAlias","join","flatten","handle_explore_response","query","getTagset","tags","forEach","tagValue","tag","push","uniq"],"mappings":"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","file":"response_handler.js","sourcesContent":["import _ from 'lodash';\n\nfunction filterLegendMetricString(name) {\n    if(name.length == 0) {\n        return '';\n    }\n    var displayString =  name;\n\n    // return alias only if any.\n    var firstIndex = displayString.lastIndexOf('(');\n\n    // if no alias and no functions present, just return the metric itself;\n    if(-1 == firstIndex){\n        return displayString;\n    }\n    var filteredString = displayString.substring(firstIndex+1);\n    var lastIndex = filteredString.indexOf(' ');\n    if(-1 == lastIndex){\n        lastIndex = filteredString.indexOf(')');\n    }\n    displayString = filteredString.substring(0, lastIndex);\n    return displayString;\n}\n\nexport function handle_response(target, response) {\n  var timeseries = _.map(response.body, (body) => {\n    return _.map(body.series, (series) => {\n      var timerange = body.timerange;\n      var datapoints = _.map(series.values, (value, index) => {\n        return [\n          Number(value), // value\n          Number(timerange.start + timerange.resolution * index)  // timestamp\n        ];\n      });\n\n      var metric_prefix = _.map(series.tagset, (value, key) => {\n        // Use !== false for backward compatibility\n        if ((key === 'app' && target.addAppToAlias !== false) ||\n            (key === 'host' && target.addHostToAlias !== false)) {\n          return value;\n        }\n        else {\n          return '';\n        }\n      }).join(' ');\n\n      return {\n        target: metric_prefix + ' ' +filterLegendMetricString(body.name),\n        datapoints: datapoints\n      };\n    });\n  });\n  return _.flatten(timeseries, true);\n}\n\nexport function handle_explore_response(query, response) {\n\n  function getTagset(response) {\n    let tags = {};\n    _.forEach(response.body['tagset'], (tagset) => {\n      _.forEach(tagset, (tagValue, tag) => {\n        if (!tags[tag]) {\n          tags[tag] = [];\n        }\n        tags[tag].push(tagValue);\n      });\n    });\n    _.forEach(tags, (tagValue, tag) => {\n      tags[tag] = _.uniq(_.flatten(tagValue));\n    });\n    return tags;\n  }\n\n  if (query === 'tagset') {\n    return getTagset(response);\n  }\n  else if (query === 'cluster') {\n    return getTagset(response)['cluster'] ;\n  }\n  else if (query === 'hosts') {\n    return getTagset(response)['hosts'] ;\n  }\n  else {\n    return response.body[query];\n  }\n}\n"]}