{"version":3,"sources":["../src/query_ctrl.js"],"names":["angular","_","QueryCtrl","MQEQuery","MQEQueryCtrl","$scope","$injector","$q","uiSegmentSrv","templateSrv","scope","target_defaults","rawQuery","metrics","metric","functionList","func","apps","hosts","addAppToAlias","addHostToAlias","defaults","target","appSegments","map","newSegment","hostSegments","removeSegment","fake","value","fixSegments","availableMetrics","updateMetrics","getMetrics","bind","availableOperators","updateOperators","getOperators","availableFunctions","udpateFunctions","getFunctions","$on","onChangeInternal","query","datasource","_mqe_query","then","result","body","_mqe_explore","self","exploreMetrics","panelCtrl","refresh","segment","type","undefined","filter","push","newPlusButton","selectedMetric","search","contains","index","joins","joinOP","joinMetric","splice","length","functions","operatorRegex","fn","opList","extractOpList","clone","variables","variable","unshift","name","operatorList","fns","describeQuery","getColumns","invokeMQEQuery","segments","transformToSegments","copy","operatorlist","forEach","item","indexOf","refineFunctionList","results","addTemplateVars","flatten","toString","expandable","count","lastSegment","Math","max","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport {QueryCtrl} from 'app/plugins/sdk';\nimport MQEQuery from './query_builder';\n\nexport class MQEQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, $q, uiSegmentSrv, templateSrv)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.$q = $q;\n    this.uiSegmentSrv = uiSegmentSrv;\n    this.templateSrv = templateSrv;\n\n    var target_defaults = {\n      rawQuery: \"\",\n      metrics: [{ metric: \"\"}],\n      functionList:[{ func: \"\"}],\n      apps: [],\n      hosts: [],\n      addAppToAlias: true,\n      addHostToAlias: true\n    };\n    _.defaults(this.target, target_defaults);\n\n    this.appSegments = _.map(this.target.apps, this.uiSegmentSrv.newSegment);\n    this.hostSegments = _.map(this.target.hosts, this.uiSegmentSrv.newSegment);\n    this.removeSegment = uiSegmentSrv.newSegment({fake: true, value: '-- remove --'});\n    this.fixSegments(this.appSegments);\n    this.fixSegments(this.hostSegments);\n\n    // bs-typeahead can't work with async code so we need to\n    // store metrics first.\n    this.availableMetrics = [];\n    this.updateMetrics();\n    // Pass this to getMetrics() function, because it's called from bs-typeahead\n    // without proper context.\n    this.getMetrics = _.bind(this.getMetrics, this);\n\n    // operators\n    this.availableOperators = [];\n    this.updateOperators();\n\n    // get operators here\n    this.getOperators = _.bind(this.getOperators, this);\n\n    this.availableFunctions = [];\n    //this.availableTotalFunctionList = [];\n    this.udpateFunctions();\n\n    //get functions here\n    this.getFunctions = _.bind(this.getFunctions, this);\n\n    // Update panel when metric selected from dropdown\n    $scope.$on('typeahead-updated', () => {\n      this.onChangeInternal();\n    });\n  }\n\n  invokeMQEQuery(query) {\n    return this.datasource._mqe_query(query).then(result => {\n      return result.body;\n    });\n  }\n\n  exploreMetrics(query) {\n    return this.datasource._mqe_explore(query);\n  }\n\n  updateMetrics() {\n    var self = this;\n    this.exploreMetrics('metrics').then(metrics => {\n      self.availableMetrics = metrics;\n    });\n  }\n\n  // Event handlers\n\n  onChangeInternal() {\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n  }\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n  getCollapsedText() {\n    return this.target.rawQuery;\n  }\n\n  appSegmentChanged(segment) {\n    if (segment.type === 'plus-button') {\n      segment.type = undefined;\n    }\n    this.target.apps = _.map(_.filter(this.appSegments, segment => {\n      return (segment.type !== 'plus-button' &&\n              segment.value !== this.removeSegment.value);\n    }), 'value');\n    this.appSegments = _.map(this.target.apps, this.uiSegmentSrv.newSegment);\n    this.appSegments.push(this.uiSegmentSrv.newPlusButton());\n    this.onChangeInternal();\n  }\n\n  hostSegmentChanged(segment) {\n    if (segment.type === 'plus-button') {\n      segment.type = undefined;\n    }\n    this.target.hosts = _.map(_.filter(this.hostSegments, segment => {\n      return (segment.type !== 'plus-button' &&\n              segment.value !== this.removeSegment.value);\n    }), 'value');\n    this.hostSegments = _.map(this.target.hosts, this.uiSegmentSrv.newSegment);\n    this.hostSegments.push(this.uiSegmentSrv.newPlusButton());\n    this.onChangeInternal();\n  }\n\n  checkMetrics(selectedMetric) {\n    if((selectedMetric.search(/[*!]/)) !== -1 || (_.contains(this.availableMetrics, selectedMetric) === true)) {\n      this.onChangeInternal();\n    }\n  }\n\n  addMetric() {\n    this.target.metrics.push({metric: \"\"});\n    this.onChangeInternal();\n  }\n\n  addFunction() {\n    this.target.functionList.push({ func: \"\" });\n    this.onChangeInternal();\n  }\n\n  addJoinMetric(index) {\n    if (this.target.metrics[index].joins === undefined) {\n      this.target.metrics[index][\"joins\"] = [{joinOP: \"\", joinMetric: \"\"}];\n    }\n    else {\n      this.target.metrics[index]['joins'].push({joinOP:\"\", joinMetric:\"\"});\n    }\n    this.onChangeInternal();\n  }\n\n  removeJoinMetric(index) {\n    this.target.metrics[index].joins.splice(this.target.metrics[index].joins.length-1, 1);\n    this.onChangeInternal();\n  }\n\n  removeMetric(index) {\n    this.target.metrics.splice(index, 1);\n    this.onChangeInternal();\n  }\n\n  removeFunction() {\n    this.target.functionList.splice(this.target.functionList.length-1, 1);\n    this.onChangeInternal();\n  }\n\n  extractOpList(functions) {\n    var functionList = functions;\n    var operatorRegex = /[\\+\\-\\*\\/~`\\!@#$%\\^&()|><\\?]/;\n    return _.filter(functionList, function (fn) {\n      return fn.search(operatorRegex) !== -1;\n    });\n  }\n\n  updateOperators() {\n    var self = this;\n    var opList;\n\n    return this.exploreMetrics('functions').then(functions => {\n      opList = this.extractOpList(functions);\n      self.availableOperators = opList;\n    });\n  }\n  ///////////////////////\n  // Query suggestions //\n  ///////////////////////\n\n  getMetrics() {\n    // Don't touch original metric list\n    var metrics = _.clone(this.availableMetrics);\n    for (let variable of this.templateSrv.variables) {\n      metrics.unshift('$' + variable.name);\n    }\n    return metrics;\n  }\n\n  getOperators() {\n    //if(this.availableOperators.length === 0) {\n    //  var functions = this.availableTotalFunctionList;\n    //  this.availableOperators = this.extractOpList(functions);\n    //}\n    var operatorList = _.clone(this.availableOperators);\n    return operatorList;\n  }\n\n  getFunctions() {\n    var fns = _.clone(this.availableFunctions);\n    for (let variable of this.templateSrv.variables) {\n      fns.unshift('$' + variable.name);\n    }\n    return fns;\n  }\n\n  describeMetric(metric) {\n    var describeQuery = MQEQuery.getColumns(metric);\n    return this.invokeMQEQuery(describeQuery);\n  }\n\n  getApps() {\n    return this.exploreMetrics('cluster').then(apps => {\n      let segments = this.transformToSegments(apps, true);\n      segments.splice(0, 0, angular.copy(this.removeSegment));\n      return segments;\n    });\n  }\n\n  getHosts() {\n    return this.exploreMetrics('hosts').then(hosts => {\n      let segments = this.transformToSegments(hosts, true);\n      segments.splice(0, 0, angular.copy(this.removeSegment));\n      return segments;\n    });\n  }\n\n  refineFunctionList(functions) {\n    var functionList = [];\n    functionList.push(functions);\n    var operatorlist = ['*','+','-','/'];\n    _.forEach(operatorlist, function (item) {\n      var index = functionList.indexOf(item);\n      if (index > -1) {\n        functionList.splice(index, 1);\n      }\n    });\n    return functionList;\n\n  }\n  udpateFunctions() {\n    var self = this;\n    var functionList;\n\n    return this.exploreMetrics('functions').then((functions) => {\n      // remove operators like *+-/ from the function list\n      //self.availableTotalFunctionList = functions;\n      functionList = this.refineFunctionList(functions);\n      self.availableFunctions = functionList;\n    });\n  }\n  ///////////////////////\n\n  transformToSegments(results, addTemplateVars) {\n    var segments = _.map(_.flatten(results), value => {\n      return this.uiSegmentSrv.newSegment({\n        value: value.toString(),\n        expandable: false\n      });\n    });\n\n    if (addTemplateVars) {\n      for (let variable of this.templateSrv.variables) {\n        segments.unshift(this.uiSegmentSrv.newSegment({ type: 'template', value: '$' + variable.name, expandable: true }));\n      }\n    }\n    return segments;\n  }\n\n  fixSegments(segments) {\n    var count = segments.length;\n    var lastSegment = segments[Math.max(count-1, 0)];\n\n    if (!lastSegment || lastSegment.type !== 'plus-button') {\n      segments.push(this.uiSegmentSrv.newPlusButton());\n    }\n  }\n\n}\n\nMQEQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}